<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TimeTracker Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #ffffff; }
        .glass-card {
            background: #F9FAFB; /* Very light gray/white */
            border: 1px solid #E5E7EB;
            border-radius: 24px;
        }
        .matrix-box { transition: all 0.2s ease; }

        /* Hide Date Input Icon but keep clickable */
        input[type="date"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
    </style>
</head>
<body class="text-gray-800 p-6 md:p-12 min-h-screen max-w-6xl mx-auto">

    <div class="mb-10">
        <div class="flex justify-between items-end mb-6">
            <div>
                <h2 class="text-4xl font-bold tracking-tight text-gray-900">{{ current_month }}</h2>
                <p class="text-gray-400 font-medium mt-1">Productivity Report</p>
            </div>

            <div class="relative group cursor-pointer bg-gray-100 hover:bg-gray-200 transition p-3 rounded-full">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-700"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>

                <input type="date" onchange="window.location.href='/?date='+this.value" value="{{ selected_date }}">
            </div>
        </div>

        <div class="flex justify-between items-center md:justify-start md:gap-6 overflow-x-auto pb-2">
            {% for day in week_days %}
            <a href="/?date={{ day.full_str }}" class="flex flex-col items-center group cursor-pointer min-w-[50px]">

                <span class="text-xs font-semibold uppercase mb-2
                    {% if day.is_selected %} text-rose-500 {% else %} text-gray-400 group-hover:text-gray-600 {% endif %}">
                    {{ day.day_name }}
                </span>

                <div class="w-10 h-10 flex items-center justify-center rounded-full text-sm font-bold transition-all
                    {% if day.is_selected %}
                        bg-rose-500 text-white shadow-lg shadow-rose-200 scale-110
                    {% else %}
                        bg-transparent text-gray-700 hover:bg-gray-100
                    {% endif %}">
                    {{ day.day_num }}
                </div>
            </a>
            {% endfor %}
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">

        <div class="md:col-span-2 glass-card p-8">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-gray-900">Priority Breakdown</h2>
            </div>

            <div class="grid grid-cols-2 gap-4 h-80">

                <div class="matrix-box bg-emerald-50 rounded-2xl p-5 flex flex-col justify-between border border-emerald-100 ring-1 ring-emerald-200/50">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="text-emerald-900 font-bold text-lg">Growth</h3>
                            <p class="text-xs text-emerald-600 font-semibold uppercase tracking-wider">Imp, Not Urg</p>
                        </div>
                        <span class="text-2xl text-emerald-300">★</span>
                    </div>
                    <div>
                        <div class="text-3xl font-bold text-gray-900">{{ matrix.q2.hours }}<span class="text-sm text-gray-500 font-normal ml-1">hrs</span></div>
                        <div class="text-sm font-medium text-emerald-600 mt-1">{{ matrix.q2.pct }}%</div>
                    </div>
                </div>

                <div class="matrix-box bg-amber-50 rounded-2xl p-5 flex flex-col justify-between border border-amber-100">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="text-amber-900 font-bold text-lg">Critical</h3>
                            <p class="text-xs text-amber-600 font-semibold uppercase tracking-wider">Both</p>
                        </div>
                        <span class="text-2xl text-amber-300">!</span>
                    </div>
                    <div>
                        <div class="text-3xl font-bold text-gray-900">{{ matrix.q1.hours }}<span class="text-sm text-gray-500 font-normal ml-1">hrs</span></div>
                        <div class="text-sm font-medium text-amber-600 mt-1">{{ matrix.q1.pct }}%</div>
                    </div>
                </div>

                <div class="matrix-box bg-stone-100 rounded-2xl p-5 flex flex-col justify-between border border-stone-200">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="text-stone-700 font-bold text-lg">Drudgery</h3>
                            <p class="text-xs text-stone-500 font-semibold uppercase tracking-wider">Urg, Not Imp</p>
                        </div>
                        <span class="text-2xl text-stone-300">#</span>
                    </div>
                    <div>
                        <div class="text-3xl font-bold text-gray-800">{{ matrix.q3.hours }}<span class="text-sm text-gray-500 font-normal ml-1">hrs</span></div>
                        <div class="text-sm font-medium text-stone-600 mt-1">{{ matrix.q3.pct }}%</div>
                    </div>
                </div>

                <div class="matrix-box bg-rose-50 rounded-2xl p-5 flex flex-col justify-between border border-rose-100">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="text-rose-900 font-bold text-lg">Waste</h3>
                            <p class="text-xs text-rose-600 font-semibold uppercase tracking-wider">Neither</p>
                        </div>
                        <span class="text-2xl text-rose-300">X</span>
                    </div>
                    <div>
                        <div class="text-3xl font-bold text-gray-900">{{ matrix.q4.hours }}<span class="text-sm text-gray-500 font-normal ml-1">hrs</span></div>
                        <div class="text-sm font-medium text-rose-600 mt-1">{{ matrix.q4.pct }}%</div>
                    </div>
                </div>

            </div>
        </div>

        <div class="glass-card p-8 flex flex-col">
            <h2 class="text-xl font-bold mb-6">Tags</h2>
            <div class="flex-grow flex items-center justify-center">
                {% if tags.labels %}
                <canvas id="tagChart"></canvas>
                {% else %}
                <div class="text-center">
                    <p class="text-gray-300 text-4xl mb-2">∅</p>
                    <p class="text-gray-400 text-sm">No logs found for<br>{{ selected_date }}</p>
                </div>
                {% endif %}
            </div>
            <div class="mt-6 border-t border-gray-100 pt-4 flex justify-between">
                 <span class="text-gray-500">Total</span>
                 <span class="font-bold text-xl">{{ matrix.total_hours }} hrs</span>
            </div>
        </div>
    </div>

    <script>
        {% if tags.labels %}
        const ctx = document.getElementById('tagChart').getContext('2d');
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: {{ tags.labels | safe }},
                datasets: [{
                    data: {{ tags.data | safe }},
                    backgroundColor: ['#10B981', '#F59E0B', '#78716C', '#F43F5E', '#3B82F6'],
                    borderWidth: 0,
                    hoverOffset: 4
                }]
            },
            options: {
                responsive: true,
                cutout: '70%',
                plugins: {
                    legend: { position: 'bottom', labels: { usePointStyle: true, font: { family: 'Plus Jakarta Sans', size: 11 } } }
                }
            }
        });
        {% endif %}
    </script>
</body>
</html>